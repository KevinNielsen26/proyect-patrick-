// server/prisma/schema.prisma

generator client {
  provider   = "prisma-client-js"
  engineType = "library" // <--- ESTO SOLUCIONA EL ERROR DE "ENGINE TYPE CLIENT"
}

datasource db {
  provider = "postgresql"
}



enum TransactionType {
  FAUCET_CLAIM
  BET_SLOT
  WIN_SLOT
}

model User {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email           String        @unique
  password        String        // Recuerda hashear con bcrypt/argon2
  username        String        @unique
  balance         Int           @default(1000) // Manejo en centavos o unidad mÃ­nima
  lastFaucetClaim DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt @default(now())

  transactions    Transaction[]
  gameRounds      GameRound[]

  @@index([email])
}

model GameRound {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @db.Uuid
  gameType  String   @default("SLOTS_3_REEL")
  betAmount Int
  payout    Int      @default(0)
  result    Json     // Ej: { reels: ["ðŸ€", "ðŸ’Ž", "ðŸ€"], isWin: false }
  clientSeed String? // Opcional: para provably fair en el futuro
  serverSeed String? // Opcional: para provably fair en el futuro
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])

  // RelaciÃ³n inversa para fÃ¡cil acceso
  transactions Transaction[]
}

model Transaction {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String @db.Uuid
  amount      Int             // Puede ser negativo (apuesta) o positivo (ganancia)
  type        TransactionType
  referenceId String?         @db.Uuid// ID del GameRound o referencia externa
  createdAt   DateTime        @default(now())

  user        User       @relation(fields: [userId], references: [id])
  gameRound   GameRound? @relation(fields: [referenceId], references: [id])

  @@index([userId])
}