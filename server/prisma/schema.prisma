// server/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}



// Mant√©n tu configuraci√≥n de generator y datasource existente

enum TransactionType {
  FAUCET_CLAIM
  BET_SLOT
  WIN_SLOT
}

model User {
  id              String        @id @default(uuid())
  email           String        @unique
  password        String        // Recuerda hashear con bcrypt/argon2
  username        String        @unique
  balance         Int           @default(1000) // Manejo en centavos o unidad m√≠nima
  lastFaucetClaim DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  transactions    Transaction[]
  gameRounds      GameRound[]

  @@index([email])
}

model GameRound {
  id        String   @id @default(uuid())
  userId    String
  gameType  String   @default("SLOTS_3_REEL")
  betAmount Int
  payout    Int      @default(0)
  result    Json     // Ej: { reels: ["üçÄ", "üíé", "üçÄ"], isWin: false }
  clientSeed String? // Opcional: para provably fair en el futuro
  serverSeed String? // Opcional: para provably fair en el futuro
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])

  // Relaci√≥n inversa para f√°cil acceso
  transactions Transaction[]
}

model Transaction {
  id          String          @id @default(uuid())
  userId      String
  amount      Int             // Puede ser negativo (apuesta) o positivo (ganancia)
  type        TransactionType
  referenceId String?         // ID del GameRound o referencia externa
  createdAt   DateTime        @default(now())

  user        User       @relation(fields: [userId], references: [id])
  gameRound   GameRound? @relation(fields: [referenceId], references: [id])

  @@index([userId])
}